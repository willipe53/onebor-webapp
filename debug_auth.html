<!DOCTYPE html>
<html>
  <head>
    <title>Debug Auth</title>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.3.7/dist/amazon-cognito-identity.min.js"></script>
  </head>
  <body>
    <h1>Debug Authentication</h1>
    <div id="status">Checking authentication...</div>

    <script>
      // Use your actual User Pool ID and Client ID
      const poolData = {
        UserPoolId: "us-east-2_IJ1C0mWXW",
        ClientId: "1lntksiqrqhmjea6obrrrrnmh1",
      };

      const userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
      const statusDiv = document.getElementById("status");

      function log(message) {
        console.log(message);
        statusDiv.innerHTML += "<br>" + message;
      }

      // Check current user
      const currentUser = userPool.getCurrentUser();

      if (currentUser) {
        log("‚úÖ Current user found: " + currentUser.getUsername());

        currentUser.getSession((err, session) => {
          if (err) {
            log("‚ùå Session error: " + err.message);
            return;
          }

          if (session && session.isValid()) {
            log("‚úÖ Session is valid");
            const idToken = session.getIdToken();
            const jwtToken = idToken.getJwtToken();

            log("‚úÖ JWT Token length: " + jwtToken.length);
            log("‚úÖ Token starts with: " + jwtToken.substring(0, 50) + "...");

            // Test API call
            log("üîÑ Testing API call...");

            fetch("/api/get_users", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: "Bearer " + jwtToken,
              },
              body: JSON.stringify({}),
            })
              .then((response) => {
                log("üì° API Response status: " + response.status);
                return response.text();
              })
              .then((text) => {
                log("üì° API Response body: " + text);
              })
              .catch((error) => {
                log("‚ùå API Error: " + error.message);
              });
          } else {
            log("‚ùå Session is not valid");
          }
        });
      } else {
        log("‚ùå No current user found");
        log("‚ÑπÔ∏è You need to log in first");
      }
    </script>
  </body>
</html>
