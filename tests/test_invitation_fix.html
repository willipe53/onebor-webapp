<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Invitation Fix</title>
  </head>
  <body>
    <h1>Invitation Race Condition Fix Test</h1>

    <h2>Test Scenario:</h2>
    <ol>
      <li>User visits <code>/accept_invitation/12345</code></li>
      <li>User signs up or logs in</li>
      <li>Normal onboarding should be SKIPPED because of pending invitation</li>
      <li>
        Only invitation workflow should create the client group membership
      </li>
    </ol>

    <h2>How to Test:</h2>
    <ol>
      <li>
        <strong>Manual Test 1</strong>: Visit
        <a
          href="http://localhost:5173/accept_invitation/testcode123"
          target="_blank"
          >http://localhost:5173/accept_invitation/testcode123</a
        >
      </li>
      <li>
        <strong>Manual Test 2</strong>: Check browser console for the log
        message: <br />
        <code
          >ðŸ”— Skipping normal onboarding - pending invitation found:
          testcode123</code
        >
      </li>
      <li>
        <strong>Manual Test 3</strong>: Create a real invitation and test the
        full flow
      </li>
    </ol>

    <h2>Expected Logs:</h2>
    <pre>
ðŸ”— Skipping normal onboarding - pending invitation found: [code]
Step 3: Adding user to client group membership...
Step 3 Result: {"success": true, "rows_affected": 1}
    </pre>

    <h2>Check LocalStorage:</h2>
    <button onclick="checkLocalStorage()">Check pendingInvitationCode</button>
    <div id="localStorage-result"></div>

    <h2>Set Test Invitation:</h2>
    <button onclick="setTestInvitation()">Set Test Invitation Code</button>
    <button onclick="clearTestInvitation()">Clear Test Invitation Code</button>

    <script>
      function checkLocalStorage() {
        const code = localStorage.getItem("pendingInvitationCode");
        const result = document.getElementById("localStorage-result");
        if (code) {
          result.innerHTML = `<strong>Found:</strong> ${code}`;
          result.style.color = "green";
        } else {
          result.innerHTML =
            "<strong>No pending invitation code found</strong>";
          result.style.color = "red";
        }
      }

      function setTestInvitation() {
        localStorage.setItem("pendingInvitationCode", "testcode123");
        alert("Set test invitation code: testcode123");
        checkLocalStorage();
      }

      function clearTestInvitation() {
        localStorage.removeItem("pendingInvitationCode");
        alert("Cleared test invitation code");
        checkLocalStorage();
      }

      // Auto-check on page load
      checkLocalStorage();
    </script>
  </body>
</html>
