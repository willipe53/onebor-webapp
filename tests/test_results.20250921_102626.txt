ğŸš€ onebor Comprehensive API Test Suite
Testing all functionality with detailed coverage analysis
Started at: 2025-09-21 10:26:26

ğŸ“‹ Test Plan:
   â€¢ New functionality tests: 5 files
   â€¢ Regression tests: 6 files
   â€¢ Total tests: 11 files

============================================================
ğŸ§ª Running test_invitations.py
============================================================
â±ï¸  Duration: 20.09s
âŒ test_invitations.py FAILED
STDOUT: ============================= test session starts ==============================
platform darwin -- Python 3.13.3, pytest-8.4.2, pluggy-1.6.0 -- /opt/homebrew/opt/python@3.13/bin/python3.13
cachedir: .pytest_cache
rootdir: /Users/willipe/github/onebor-webapp/tests
configfile: pytest.ini
collecting ... collected 9 items

test_invitations.py::TestInvitations::test_create_invitation_simplified_schema PASSED [ 11%]
test_invitations.py::TestInvitations::test_get_invitations_by_client_group FAILED [ 22%]
test_invitations.py::TestInvitations::test_get_invitation_by_code PASSED [ 33%]
test_invitations.py::TestInvitations::test_expire_invitation_via_redeem FAILED [ 44%]
test_invitations.py::TestInvitations::test_invitation_count_api FAILED   [ 55%]
test_invitations.py::TestInvitations::test_invitation_cors_headers PASSED [ 66%]
test_invitations.py::TestInvitations::test_invitation_validation_errors PASSED [ 77%]
test_invitations.py::TestInvitations::test_invitation_auto_generated_fields FAILED [ 88%]
test_invitations.py::TestInvitations::test_invitation_expires_at_format FAILED [100%]

=================================== FAILURES ===================================
_____________ TestInvitations.test_get_invitations_by_client_group _____________
test_invitations.py:53: in test_get_invitations_by_client_group
    client_group_id = invitation['client_group_id']
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'client_group_id'
---------------------------- Captured stdout setup -----------------------------
ğŸ”§ Setting up test environment...
   ğŸ“ Loading configuration...
   ğŸŒ Configuring AWS client...
   ğŸ“‹ Initializing tracking lists...
   ğŸ” Authenticating...
ğŸ” Authenticating with AWS Cognito...
   Trying ADMIN_NO_SRP_AUTH flow...
   âœ… Authentication successful
   ğŸ‘¤ Getting test user ID...
ğŸ” Looking up test user ID...
   âœ… Found test user ID: 10
   âœ… Test setup completed successfully
______________ TestInvitations.test_expire_invitation_via_redeem _______________
test_invitations.py:101: in test_expire_invitation_via_redeem
    original_expires_at = invitation['expires_at']
                          ^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'expires_at'
---------------------------- Captured stdout setup -----------------------------
ğŸ”§ Setting up test environment...
   ğŸ“ Loading configuration...
   ğŸŒ Configuring AWS client...
   ğŸ“‹ Initializing tracking lists...
   ğŸ” Authenticating...
ğŸ” Authenticating with AWS Cognito...
   Trying ADMIN_NO_SRP_AUTH flow...
   âœ… Authentication successful
   ğŸ‘¤ Getting test user ID...
ğŸ” Looking up test user ID...
   âœ… Found test user ID: 10
   âœ… Test setup completed successfully
__________________ TestInvitations.test_invitation_count_api ___________________
test_invitations.py:155: in test_invitation_count_api
    self.assert_success_response(invitation1)
base_test.py:152: in assert_success_response
    assert response.status_code == expected_status, f"Expected {expected_status}, got {response.status_code}: {response.text}"
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected 200, got 400: {"error": "expires_at and client_group_id are required for create action"}
---------------------------- Captured stdout setup -----------------------------
ğŸ”§ Setting up test environment...
   ğŸ“ Loading configuration...
   ğŸŒ Configuring AWS client...
   ğŸ“‹ Initializing tracking lists...
   ğŸ” Authenticating...
ğŸ” Authenticating with AWS Cognito...
   Trying ADMIN_NO_SRP_AUTH flow...
   âœ… Authentication successful
   ğŸ‘¤ Getting test user ID...
ğŸ” Looking up test user ID...
   âœ… Found test user ID: 10
   âœ… Test setup completed successfully
____________ TestInvitations.test_invitation_auto_generated_fields _____________
test_invitations.py:240: in test_invitation_auto_generated_fields
    invitation = self.assert_success_response(response)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
base_test.py:152: in assert_success_response
    assert response.status_code == expected_status, f"Expected {expected_status}, got {response.status_code}: {response.text}"
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AssertionError: Expected 200, got 400: {"error": "expires_at and client_group_id are required for create action"}
---------------------------- Captured stdout setup -----------------------------
ğŸ”§ Setting up test environment...
   ğŸ“ Loading configuration...
   ğŸŒ Configuring AWS client...
   ğŸ“‹ Initializing tracking lists...
   ğŸ” Authenticating...
ğŸ” Authenticating with AWS Cognito...
   Trying ADMIN_NO_SRP_AUTH flow...
   âœ… Authentication successful
   ğŸ‘¤ Getting test user ID...
ğŸ” Looking up test user ID...
   âœ… Found test user ID: 10
   âœ… Test setup completed successfully
______________ TestInvitations.test_invitation_expires_at_format _______________
test_invitations.py:259: in test_invitation_expires_at_format
    expires_at = invitation['expires_at']
                 ^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'expires_at'
---------------------------- Captured stdout setup -----------------------------
ğŸ”§ Setting up test environment...
   ğŸ“ Loading configuration...
   ğŸŒ Configuring AWS client...
   ğŸ“‹ Initializing tracking lists...
   ğŸ” Authenticating...
ğŸ” Authenticating with AWS Cognito...
   Trying ADMIN_NO_SRP_AUTH flow...
   âœ… Authentication successful
   ğŸ‘¤ Getting test user ID...
ğŸ” Looking up test user ID...
   âœ… Found test user ID: 10
   âœ… Test setup completed successfully
=============================== warnings summary ===============================
test_invitations.py::TestInvitations::test_create_invitation_simplified_schema
test_invitations.py::TestInvitations::test_get_invitations_by_client_group
test_invitations.py::TestInvitations::test_get_invitation_by_code
test_invitations.py::TestInvitations::test_expire_invitation_via_redeem
test_invitations.py::TestInvitations::test_invitation_count_api
test_invitations.py::TestInvitations::test_invitation_cors_headers
test_invitations.py::TestInvitations::test_invitation_validation_errors
test_invitations.py::TestInvitations::test_invitation_auto_generated_fields
test_invitations.py::TestInvitations::test_invitation_expires_at_format
  /opt/homebrew/lib/python3.13/site-packages/botocore/auth.py:425: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    datetime_now = datetime.datetime.utcnow()

test_invitations.py::TestInvitations::test_create_invitation_simplified_schema
test_invitations.py::TestInvitations::test_get_invitations_by_client_group
test_invitations.py::TestInvitations::test_get_invitation_by_code
test_invitations.py::TestInvitations::test_expire_invitation_via_redeem
test_invitations.py::TestInvitations::test_invitation_expires_at_format
  /Users/willipe/github/onebor-webapp/tests/test_invitations.py:26: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    expires_at = (datetime.utcnow() + timedelta(days=7)

test_invitations.py::TestInvitations::test_create_invitation_simplified_schema
  /opt/homebrew/lib/python3.13/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but test_invitations.py::TestInvitations::test_create_invitation_simplified_schema returned <class 'dict'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED test_invitations.py::TestInvitations::test_get_invitations_by_client_group
FAILED test_invitations.py::TestInvitations::test_expire_invitation_via_redeem
FAILED test_invitations.py::TestInvitations::test_invitation_count_api - Asse...
FAILED test_invitations.py::TestInvitations::test_invitation_auto_generated_fields
FAILED test_invitations.py::TestInvitations::test_invitation_expires_at_format
================== 5 failed, 4 passed, 15 warnings in 19.77s ===================

STDERR: 

============================================================
ğŸ§ª Running test_client_group_entities.py
============================================================
â±ï¸  Duration: 18.88s
âŒ test_client_group_entities.py FAILED
STDOUT: 